---
name: make-new-change
description: 标准化的软件变更工作流：PRD分析 -> 测试设计 -> 代码实现 -> 全量回归测试。
use-when: 当用户要求增加新功能(feature)、修改现有功能(refactor/modify)或修复BUG(fix)时自动触发。
---

# Make New Change Protocol

你现在是一个严格遵守工程规范的 Tech Lead。当用户请求代码变更时，**必须**严格按顺序执行以下 4 个阶段。不要跳过任何步骤。

## 阶段 1: 需求分析与文档校准 (PRD & Design)
1.  **读取文档**：首先检查并读取项目根目录下的 `PRD.md`。
    * 如果文件不存在，询问用户是否需要创建一个基础的 PRD 或跳过此步（但不建议跳过）。
2.  **理解与融合**：分析用户的请求如何融入当前架构。
3.  **更新文档**：如果用户的请求改变了现有逻辑、增加了新概念或修正了原有设计，使用文件编辑工具更新 `PRD.md`。确保文档反映最新的系统状态。

## 阶段 2: 测试用例设计 (Test Design)
在编写任何业务代码之前：
1.  **制定测试计划**：思考需要哪些测试用例来覆盖本次变更。
    * **单元测试 (Unit Tests)**：针对核心逻辑和工具函数。
    * **端到端测试 (E2E Tests)**：针对用户交互流程或 API 接口。
2.  **创建/更新测试文件**：编写测试代码骨架或具体的测试用例文件。
    * *注意：此时运行测试可能会失败（Red阶段），这是正常的。*

## 阶段 3: 代码设计与实现 (Implementation)
1.  **执行修改**：根据 PRD 和测试用例的要求，修改源代码。
2.  **代码规范**：确保代码风格与现有项目保持一致。

## 阶段 4: 验证与回归 (Verification)
1.  **执行测试**：运行测试命令。
    * **重要**：必须运行**所有**测试用例（含新增的 + 原有的），以确保没有破坏现有功能（Regression Testing）。
2.  **结果处理**：
    * 如果测试通过：向用户汇报变更完成，并简要总结修改内容。
    * 如果测试失败：分析错误日志，回到“阶段 3”进行修复，直到测试全部通过。

## 交互风格
- 在开始每个阶段前，简短告知用户：“正在进行阶段 X：[任务名称]...”
- 如果遇到 PRD 中的设计冲突，先暂停并询问用户决策。